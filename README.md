# test_4_veklich: Telegram Bot и FastAPI с использованием MongoDB и Redis

## Описание

Этот проект включает в себя бота для Telegram и веб-приложение на FastAPI,
которые взаимодействуют с базой данных MongoDB для хранения сообщений.
Redis используется для кэширования сообщений и ускорения доступа к ним.
Telegram бот позволяет пользователям получать и отправлять сообщения, а
также удалять их. Веб-приложение предоставляет интерфейс для отображения
и добавления сообщений.

## Требования

- Docker и Docker Compose
- Учетная запись Telegram и созданный бот с полученным API токеном

## Установка

1. Клонируйте репозиторий:
```
    git clone https://github.com/mikholand/test_4_veklich
```
2. Перейдите в каталог проекта:
```
    cd test_4_veklich
```
3. Измените файл `.env.example` на `.env` и измените токен для Telegram-бота
4. Сборка и запуск контейнеров:
```
   docker-compose up --build
```
   Это запустит все необходимые сервисы, включая MongoDB, FastAPI и
   Telegram-бота.


## Использование

### Telegram Bot

- `/start` - Показать приветственное сообщение и инструкции.
- `/get <номер-страницы>` - Получить сообщения. По умолчанию (без номера)
отображается первая страница.
- `/post <сообщение>` - Отправить новое сообщение.
- `/clear` - Удалить все сообщения.

### Веб-приложение

Откройте веб-браузер и перейдите по адресу `http://localhost:8000`. Вы увидите
интерфейс для просмотра и отправки сообщений.

## Описание компонентов

### Веб-приложение (app)

Веб-приложение построено с использованием FastAPI. Оно предоставляет API для создания и получения сообщений, а также веб-интерфейс для работы с этими сообщениями. 

- `static/`: Папка с CSS стилями
- `styles.css`: Файл с CSS стилями для отображения сайта
- `templates/`: Папка с шаблонами страниц
- `index.html`: Шаблон для страницы
- `Dockerfile`: Файл для сборки Docker-образа для веб-приложения.
- `requirements.txt`: Список зависимостей Python для веб-приложения.
- `main.py`: Основной файл FastAPI-приложения.

### Telegram-бот (bot)

Telegram-бот предоставляет команды для работы с сообщениями через Telegram. Он взаимодействует с веб-приложением, используя его API.

- `Dockerfile`: Файл для сборки Docker-образа для бота.
- `requirements.txt`: Список зависимостей Python для бота.
- `bot.py`: Основной файл бота.

### Nginx

Nginx используется как обратный прокси-сервер для маршрутизации запросов к веб-приложению и боту.

- `nginx.conf`: Конфигурационный файл для Nginx.

### Docker Compose

Файл `docker-compose.yml` используется для определения и запуска многоконтейнерных Docker-приложений. Он описывает, как связаны контейнеры веб-приложения, бота и Nginx.

## API

### Создание сообщения

- **URL:** `/api/v1/message/`
- **Метод:** `POST`
- **Формат запроса:**
    - Для формы: `username=<имя пользователя>&content=<текст сообщения>`
    - Для JSON: `{"username": "<имя пользователя>", "content": "<текст сообщения>"}`
- **Ответ:** `{"message": "Message created"}`

### Получение сообщений

- **URL:** `/api/v1/messages/`
- **Метод:** `GET`
- **Параметры запроса:**
    - `page` (необязательно): Номер страницы (по умолчанию 1)
    - `per_page` (необязательно): Количество сообщений на страницу (по умолчанию 5)
- **Ответ:** `{"messages": [{"username": "<имя пользователя>", "content": "<текст сообщения>"}], "page": <текущая страница>, "total_pages": <общее количество страниц>}`

### Удаление всех сообщений

- **URL:** `/api/v1/messages/`
- **Метод:** `DELETE`
- **Ответ:** `{"message": "All messages have been deleted"}`

## Примечания

- Убедитесь, что Redis и MongoDB запущены и доступны по указанным в `.env`
адресам.
- Для управления зависимостями используйте файл `requirements.txt`, который
можно обновлять по мере необходимости.

## Лицензия
Этот скрипт распространяется на условиях лицензии MIT. 
Подробности смотрите в файле
[LICENSE](https://github.com/mikholand/test_4_veklich/blob/master/LICENSE).

## Контакты
Михно Олег - [Telegram](https://t.me/mikholand) - mikholand@gmail.com

GitHub: [https://github.com/mikholand](https://github.com/mikholand)

LinkedIn: [https://www.linkedin.com/in/mikholand/](https://www.linkedin.com/in/mikholand/)